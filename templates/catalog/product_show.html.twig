{% extends 'base.html.twig' %}

{% block title %}{{ product.name }} | TechNova{% endblock %}

{% block body %}
{# Bloc principal affichant la galerie et les infos produit #}
<section class="tn-product-layout">
    <div class="tn-product-gallery">
        {% set mainImage = product.images|first %}
        {% if mainImage %}
            <img src="{{ mainImage.url }}" alt="{{ mainImage.alt }}">
        {% else %}
            <img src="{{ asset('assets/images/product-placeholder.svg') }}" alt="Visuel par défaut">
        {% endif %}
        <div class="tn-product-gallery__thumbs">
            {% for image in product.images %}
                <img src="{{ image.url }}" alt="{{ image.alt }}">
            {% else %}
                <img src="{{ asset('assets/images/product-placeholder.svg') }}" alt="Visuel par défaut">
            {% endfor %}
        </div>
    </div>
    <div class="tn-product-info">
        <p class="tn-product-info__category">{{ product.category.name }}</p>
        <h1>{{ product.name }}</h1>
        <p class="tn-product-info__price">{{ product.price|number_format(2, ',', ' ') }} €</p>
        <p>{{ product.description }}</p>
        <a class="btn btn-primary" href="#">Ajouter au panier</a>
        <div class="tn-product-meta">
            <div>
                <strong>Marque</strong>
                <p>{{ product.brand ? product.brand.name : 'TechNova' }}</p>
            </div>
            <div>
                <strong>Stock</strong>
                <p>{{ product.stock > 0 ? product.stock ~ ' disponibles' : 'Rupture' }}</p>
            </div>
        </div>
    </div>
</section>

{# Caractéristiques synthétiques pour rappeler les points forts #}
<section class="tn-section">
    <div class="tn-section__header">
        <h2>Caractéristiques du produit</h2>
    </div>
    <div class="tn-product-specs">
        <ul>
            {% for label, value in specifications %}
                <li>
                    <strong>{{ label }}</strong><br>
                    {{ value }}
                </li>
            {% endfor %}
        </ul>
    </div>
</section>

{% if optionGroups is not empty %}
    <section class="tn-section">
        <div class="tn-section__header">
            <h2>Options disponibles</h2>
        </div>
        <div class="tn-options">
            {% for group in optionGroups %}
                <div>
                    <h3>{{ group.name }}</h3>
                    <div class="tn-chips">
                        {% for value in group.values %}
                            <span>{{ value.label }}</span>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </section>
{% endif %}

{% if variantData is not empty %}
    <section class="tn-section">
        <div class="tn-section__header">
            <h2>Variantes proposées</h2>
        </div>
        <div class="tn-variants-list">
            {% for variant in variantData %}
                <article>
                    {% set metadataValues = [] %}
                    {% if variant.metadata %}
                        {% for key, value in variant.metadata %}
                            {% set metadataValues = metadataValues|merge([value]) %}
                        {% endfor %}
                    {% endif %}
                    <strong>
                        {% if metadataValues is not empty %}
                            {{ metadataValues|join(' • ') }}
                        {% else %}
                            Configuration standard
                        {% endif %}
                    </strong>
                    <p class="tn-variant-price">
                        {% if variant.promoPrice %}
                            <span class="tn-variant-old">{{ variant.price|number_format(2, ',', ' ') }} €</span>
                            <span>{{ variant.promoPrice|number_format(2, ',', ' ') }} €</span>
                        {% else %}
                            {{ variant.price|number_format(2, ',', ' ') }} €
                        {% endif %}
                    </p>
                    <p class="tn-variant-stock">
                        {% if variant.stock > 0 %}
                            {{ variant.stock }} en stock
                        {% else %}
                            Réapprovisionnement en cours
                        {% endif %}
                    </p>
                </article>
            {% endfor %}
        </div>
    </section>
{% endif %}

{# Avis clients fictifs issus des fixtures #}
<section class="tn-section">
    <div class="tn-section__header">
        <h2>Avis clients</h2>
    </div>
    <div class="tn-reviews">
        {% if product.reviews|length > 0 %}
            {% for review in product.reviews %}
                <article>
                    <strong>{{ review.rating }}/5</strong>
                    <p>{{ review.comment }}</p>
                </article>
            {% endfor %}
        {% else %}
            <p>Aucun avis pour le moment.</p>
        {% endif %}
    </div>
</section>
{% endblock %}
