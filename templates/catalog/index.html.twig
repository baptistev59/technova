{% extends 'base.html.twig' %}

{% block title %}Catalogue | TechNova{% endblock %}

{% block body %}
{# Entête catalogue : champs de recherche/tri #}
<section class="tn-section">
    <h1>Catalogue produits</h1>
    <div class="tn-filters">
        <input type="text" placeholder="Rechercher un produit…">
        <div class="tn-select">
            <select onchange="window.location=this.value">
                <option value="{{ path('catalog_index', { brand: activeFilters.brand }) }}" {{ not activeFilters.category ? 'selected' }}>Catégorie</option>
                {% for category in categories %}
                    <option value="{{ path('catalog_index', { category: category.slug, brand: activeFilters.brand }) }}" {{ activeFilters.category == category.slug ? 'selected' }}>{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="tn-select">
            <select onchange="window.location=this.value">
                <option value="{{ path('catalog_index', { category: activeFilters.category }) }}" {{ not activeFilters.brand ? 'selected' }}>Marque</option>
                {% for brand in brands %}
                    <option value="{{ path('catalog_index', { category: activeFilters.category, brand: brand.slug }) }}" {{ activeFilters.brand == brand.slug ? 'selected' }}>{{ brand.name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
</section>

{# Grille principale du catalogue #}
<section class="tn-section">
    <div class="tn-products-grid">
        {% for product in products %}
            <article class="tn-product-card">
                {% set mainImage = product.images|first %}
                {% if mainImage %}
                    <img src="{{ mainImage.url }}" alt="{{ mainImage.alt }}">
                {% else %}
                    <img src="{{ asset('assets/images/product-placeholder.svg') }}" alt="Visuel par défaut">
                {% endif %}
                <h3>{{ product.name }}</h3>
                <p class="tn-product-card__excerpt">{{ product.shortDescription }}</p>
                <div class="tn-product-card__meta">
                    <span>{{ product.brand ? product.brand.name : product.shop.name }}</span>
                    <strong>{{ product.price|number_format(2, ',', ' ') }} €</strong>
                </div>
                <a class="btn btn-primary" href="{{ path('product_show', {slug: product.slug}) }}">Voir le produit</a>
            </article>
        {% else %}
            <p>Aucun produit ne correspond à votre recherche.</p>
        {% endfor %}
    </div>
</section>
{% endblock %}
