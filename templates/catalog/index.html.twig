{% extends 'base.html.twig' %}

{% block title %}Catalogue | TechNova{% endblock %}

{% block body %}
{# Entête catalogue : champs de recherche/tri #}
<section class="tn-section">
    <h1>Catalogue produits</h1>
    <form class="tn-filters" method="get" action="{{ path('catalog_index') }}">
        <input type="text" name="search" value="{{ activeFilters.search }}" placeholder="Rechercher un produit…" onkeydown="if (event.key === 'Enter') { this.form.requestSubmit(); }">
        <div class="tn-select">
            <select name="category" onchange="this.form.requestSubmit()">
                <option value="">Toutes les catégories</option>
                {% for category in categories %}
                    <option value="{{ category.slug }}" {{ activeFilters.category == category.slug ? 'selected' }}>{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="tn-select">
            <select name="brand" onchange="this.form.requestSubmit()">
                <option value="">Toutes les marques</option>
                {% for brand in brands %}
                    <option value="{{ brand.slug }}" {{ activeFilters.brand == brand.slug ? 'selected' }}>{{ brand.name }}</option>
                {% endfor %}
            </select>
        </div>
        <input type="number" name="minPrice" value="{{ activeFilters.minPrice }}" min="0" step="50" placeholder="Prix min (€)" onkeydown="if (event.key === 'Enter') { this.form.requestSubmit(); }">
        <input type="number" name="maxPrice" value="{{ activeFilters.maxPrice }}" min="0" step="50" placeholder="Prix max (€)" onkeydown="if (event.key === 'Enter') { this.form.requestSubmit(); }">
        <div class="tn-select">
            <select name="sort" onchange="this.form.requestSubmit()">
                <option value="newest" {{ activeFilters.sort == 'newest' or not activeFilters.sort ? 'selected' }}>Plus récents</option>
                <option value="oldest" {{ activeFilters.sort == 'oldest' ? 'selected' }}>Plus anciens</option>
                <option value="price_asc" {{ activeFilters.sort == 'price_asc' ? 'selected' }}>Prix croissant</option>
                <option value="price_desc" {{ activeFilters.sort == 'price_desc' ? 'selected' }}>Prix décroissant</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Filtrer</button>
        <a class="btn btn-outline" href="{{ path('catalog_index') }}">Réinitialiser</a>
    </form>
</section>

{# Grille principale du catalogue #}
<section class="tn-section">
    <div class="tn-section__header">
        <h2>{{ resultsCount }} produit{{ resultsCount > 1 ? 's' }}</h2>
    </div>
    <div class="tn-products-grid">
        {% for product in products %}
            <article class="tn-product-card">
                {% set mainImage = product.images|first %}
                {% if mainImage %}
                    <img src="{{ mainImage.url }}" alt="{{ mainImage.alt }}">
                {% else %}
                    <img src="{{ asset('assets/images/product-placeholder.svg') }}" alt="Visuel par défaut">
                {% endif %}
                <h3>{{ product.name }}</h3>
                <p class="tn-product-card__excerpt">{{ product.shortDescription }}</p>
                <div class="tn-product-card__meta">
                    <span>{{ product.brand ? product.brand.name : product.shop.name }}</span>
                    <strong>{{ product.price|number_format(2, ',', ' ') }} €</strong>
                </div>
                <div class="tn-product-card__cta">
                    <a class="btn btn-primary" href="{{ path('product_show', {slug: product.slug}) }}">Voir le produit</a>
                </div>
            </article>
        {% else %}
            <p>Aucun produit ne correspond à votre recherche.</p>
        {% endfor %}
    </div>
</section>
{% endblock %}
